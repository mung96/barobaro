package baro.baro.global.utils;

import baro.baro.domain.contract.entity.Contract;
import baro.baro.domain.contract.entity.SignatureInformation;
import baro.baro.domain.contract.repository.ContractRepository;
import baro.baro.domain.contract.repository.SignatureInformationRepository;
import baro.baro.global.dto.PdfCreateDto;
import baro.baro.global.exception.CustomException;
import baro.baro.global.s3.PdfS3Service;
import com.itextpdf.forms.PdfAcroForm;
import com.itextpdf.forms.fields.PdfSignatureFormField;
import com.itextpdf.io.image.ImageData;
import com.itextpdf.io.image.ImageDataFactory;
import com.itextpdf.kernel.font.PdfFont;
import com.itextpdf.kernel.geom.Rectangle;
import com.itextpdf.kernel.pdf.PdfDocument;
import com.itextpdf.kernel.pdf.PdfReader;
import com.itextpdf.kernel.pdf.PdfWriter;
import com.itextpdf.kernel.pdf.StampingProperties;
import com.itextpdf.kernel.pdf.canvas.parser.PdfTextExtractor;
import com.itextpdf.layout.Document;
import com.itextpdf.layout.element.AreaBreak;
import com.itextpdf.layout.element.Paragraph;
import com.itextpdf.layout.element.Tab;
import com.itextpdf.layout.element.TabStop;
import com.itextpdf.layout.property.TabAlignment;
import com.itextpdf.layout.property.TextAlignment;
import com.itextpdf.signatures.*;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import org.springframework.web.multipart.MultipartFile;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.security.GeneralSecurityException;
import java.security.PrivateKey;
import java.security.cert.Certificate;
import java.security.cert.X509Certificate;
import java.text.NumberFormat;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.Base64;
import java.util.List;
import java.util.Locale;

import static baro.baro.global.statuscode.ErrorCode.NOT_MADE_FROM_BAROBARO;

@Slf4j
@Component
@RequiredArgsConstructor
public class PdfUtils {
    private static final String COMPANY_BASE64_SIGNATURE = "data:image/png;base64,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";
    private static final String BAROBARO_ALIAS = "barobaro";
    private static final String BAROBARO_PASSWORD = "ssafya401";

    private final SignatureInformationRepository signatureInformationRepository;
    private final PdfS3Service pdfS3Service;
    private final CertificateUtils certificateUtils;
    private final String[] units = {
            "", "만", "억", "조", "경"
    };

    private final String[] digits = {
            "영", "일", "이", "삼", "사",
            "오", "육", "칠", "팔", "구"
    };
    private final PdfFont koreanFont;
    private final ContractRepository contractRepository;

    private String convert2Korean(Long price) {
        if (price == 0) {
            return digits[0]; // "영"
        }

        StringBuilder result = new StringBuilder();
        int unitIndex = 0;

        while (price > 0) {
            long chunk = price % 10000; // 1만 단위로 나눔
            if (chunk > 0) {
                StringBuffer chunkStr = new StringBuffer();
                int digitIndex = 0;

                while (chunk > 0) {
                    int digit = (int) (chunk % 10);
                    if (digit > 0) {
                        chunkStr.insert(0, digits[digit] + (digitIndex > 0 ? units[digitIndex] : ""));
                    }
                    chunk /= 10;
                    digitIndex++;
                }

                result.insert(0, chunkStr + units[unitIndex]);
            }
            price /= 10000;
            unitIndex++;
        }

        return result.toString() + "원"; // "원" 추가
    }

    private String formatNumber(long number) {
        // Locale.US를 사용하여 미국식 천 단위 구분자 사용
        NumberFormat formatter = NumberFormat.getInstance(Locale.US);
        return formatter.format(number);
    }

    private String telFormat(String tel) {
        String First = tel.substring(0, 3);
        String Second = tel.substring(3, 8);
        String Third = tel.substring(8);
//        return First + "-" + Second + "-" + Third;
        return tel;
    }

    public String createPdf(PdfCreateDto pdfCreateDto) throws IOException, GeneralSecurityException {
        // 문서 상단에 ID 추가

        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        PdfWriter writer = new PdfWriter(byteArrayOutputStream);
        PdfDocument pdfDocument = new PdfDocument(writer);
        Document document = new Document(pdfDocument).setFont(koreanFont);
        document.add(new Paragraph("문서 ID: " + pdfCreateDto.getDocumentSerialNumber()).setFontSize(10).setTextAlignment(TextAlignment.RIGHT));
        document.add(new Paragraph("임대계약서").setTextAlignment(TextAlignment.CENTER).setFontSize(20));
        document.add(new Paragraph(pdfCreateDto.getOwnerName() + "(이하 ‘갑’이라 함)과(와) " + pdfCreateDto.getRentalName() + "(이하 ‘을’이라 함)과(와) 바로바로(이하 '병'이라 함)은 다음과 같이 임대계약을 체결한다."));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 1조] 계약의 성립").setFontSize(12));
        if (pdfCreateDto.getProductSerialNumber().trim().isEmpty()) {
            document.add(new Paragraph("① 본 계약에서 대여 제품, 대여비, 대여 기간이라 함은 " + pdfCreateDto.getProductName() + ", " +
                    "금 " + convert2Korean(pdfCreateDto.getTotalRentalPrice()) + "(" + formatNumber(pdfCreateDto.getTotalRentalPrice()) + "), " +
                    pdfCreateDto.getRentalStartDate() + " ~ " + pdfCreateDto.getRentalEndDate() + "으로 진행한다."));
        } else {
            document.add(new Paragraph("① 본 계약에서 대여 제품, 대여비, 대여 기간이라 함은 " + pdfCreateDto.getProductName() +
                    "(" + pdfCreateDto.getProductSerialNumber() + "), " +
                    "금 " + convert2Korean(pdfCreateDto.getTotalRentalPrice()) + "(" + formatNumber(pdfCreateDto.getTotalRentalPrice()) + "), " +
                    pdfCreateDto.getRentalStartDate() + " ~ " + pdfCreateDto.getRentalEndDate() + "으로 진행한다."));
        }
        document.add(new Paragraph("②‘갑’은 대여 서비스를 제공하는 선량한 개인으로써 정직하고 책임감 있게 대여 서비스를 제공하여야하며, ‘을’은 대여 서비스를 받는 선량한 개인으로써 대여 제품의 사용 및 책임의 주체가 된다. ‘병’은 대여 서비스만을 중개하는 업체로써, ‘갑’과 ‘을’간의 분쟁 발생 시에 법적 책임을 지지 않는다."));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 2조] (대여 제품 녹화)").setFontSize(12));
        document.add(new Paragraph("택배로 대여 제품을 반납할 경우, ‘을’은 대여 제품의 점검, 포장, 택배 발송 등의 정황을 CCTV 및 영상기기 등을 활용하여 녹화하고 이를 ‘병’에게 제공해야 한다. ‘병’은 해당 영상을 계약이 종료되고 14일까지 보관할 수 있다. 법적 분쟁 발생 시에 ‘병’에게 증거자료를 요청할 수 있고 ‘병’은 영상 편집하지 않고 원본으로 수사기관 및 사법기관에 제출한다."));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 3조] (일방적 계약 취소)").setFontSize(12));
        document.add(new Paragraph("""
                ①’갑’이 일방적으로 계약을 취소했을 경우에 ’갑’은 ‘을’에게 보상 의무가 있다. 이 때, 대여 기간 시작일을 기준으로 한다.
                7일 전 취소 시, 보상 의무 없음
                3일 전 취소 시, 대여금의 50%
                3일 이후 취소 시, 대여금의 100%
                ②‘을’이 일방적으로 계약을 취소했을 경우에 ’을’은 ‘갑’에게 보상 의무가 있다. 이 때, 대여 기간 시작일을 기준으로 한다.
                7일 전 취소 시, 보상 의무 없음
                3일 전 취소 시, 대여금의 50%
                3일 이후 취소 시, 대여금의 100%"
                """
        ));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 4조] (대여 제품 수령 후 하자 발견 및 사용 중 갑작스러운 고장)").setFontSize(12));
        document.add(new Paragraph("""
                ①‘을’은 대여 제품을 수령한 당일에 하자 유무를 확인하여야 하며, 하자 발견 즉시 ‘갑’에게 보고를 하고 협의 하에 조치를 취하도록 한다. 단, 하자가 아님에도 물건을 반송한 경우에는 ‘갑’의 과실이 아닌 ‘을’의 과실이므로 반송 과정 중 발생한 비용(택배비나 퀵비용 등)은 ‘갑’이 지불한다. ‘갑’이 제품 수령일에 ‘을’에게 하자에 대한 보고를 하지 않는다면, 정상 제품을 수령한 것으로판단한다.
                ②‘을’의 과실이 아닌 상황으로, 갑작스러운 고장으로 인해 사용이 불가능해질 경우 ‘을’은 ‘갑’에게 즉시 해당내용을 알리며 반납조치를 취하고 조기반납으로 인한 일수만큼의 환불을 보장받는다.
                """
        ));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 5조] (수리)").setFontSize(12));
        document.add(new Paragraph("대여 제품 손상 시, 수리는 제조사 또는 공식 수입사의 AS 센터에서 처리하도록 하며 ‘갑’과 ‘을’은 대여 제품을 자체적으로 개조하지 않고 수리하지 않는다. 수리가 진행될 경우, ‘갑’은 ‘을’에게 수리센터에서 발급한 수리비 견적서나 영수증을 제출해야 한다. 이는 ‘갑’, ‘을’ 모두 부정행위를 저지르지 않게 하기 위함이다."));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 6조] (수리 가능한 수준의 제품 손상 및 부분 분실의 경우)").setFontSize(12));
        document.add(new Paragraph("""
                ①‘을’은 대여 제품의 손상 및 부분 분실한 경우, 즉시 ‘갑’에게 보고한다.
                ②반납 후 대여 제품의 손상 및 부분 분실이 발견되었을 경우, ‘갑’은 ‘을’에게 보고한다.
                ③해당 사안의 경우, ‘을’은 영업손실 비용을 ‘갑’에게 지불한다. 영업손실 비용은 수리비용 또는 분실품 구매 비용과 수리 또는 구매 기간 중 대여료를 합한 비용을 뜻한다.
                """
        ));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 7조] (도난, 분실, 수리불가 수준의 손상의 경우)").setFontSize(12));
        document.add(new Paragraph("‘을’이 대여 제품을 도난, 분실하였거나 수리 불가 수준으로 손상하였을 경우, ‘갑’은 새 제품을 구매하여 대여를 지속하고 ‘을’은 새 제품 구매 비용을 ‘갑’에게 지불한다."));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 8조] (무단 연체)").setFontSize(12));
        document.add(new Paragraph("①‘을’은 대여 기간 종료 후 " + pdfCreateDto.getOverdueCriteria() + "일 안에 대여 제품을 ‘갑’에게 반환해야 한다. 이를 어길 시에, 대여 기간에 따른 무단 연체료가 발생한다. 무단 연체료는 연체된 날마다 대여 제품 1일 가격의 " +
                pdfCreateDto.getOverdueFee() + "배로 계산한다. 예를 들어, 1일 가격이 1만 5천원일 때, 1일 연체되었을 경우 " + convert2Korean(15000L * pdfCreateDto.getOverdueFee()) + "의 연체료가 발생한다.\n" +
                "②무단 연체료는 정상 반납이 될 때까지 부과되는 요금이지만, ‘을’이 무단 연체를 " + pdfCreateDto.getTheftCriteria() + "일 이상 지속할 경우 도난으로 취급하고 새 제품 구매 비용을 청구한다. 이는 새제품 구매 비용보다 연체료가 크게 나오는 것을 방지하기 위함이다.\n" +
                "③‘을’과 연락이 지속되는 경우라도, " + pdfCreateDto.getTheftCriteria() + "일 이상 무단 연체를 지속한다면 해당 사안을 도난으로 취급한다. 이는 ‘을’이 악의적으로 연락만 지속하고 반납을 하지않아 ‘갑’에게 더 큰 영업 손실을 안기는 것을 방지하기 위함이다."

        ));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 9조] (청구 비용의 지불)").setFontSize(12));
        document.add(new Paragraph("‘을’은 ‘갑’이 청구한 비용을 청구한 시점 기준 " + pdfCreateDto.getRefundDeadline() + "일 내에 지불해야 한다. ‘을’이 이를 어길 시, ‘갑’은 ‘을’을 민형사상 고소 할 수 있으며 법원에 지불하는 인지대, 송달비 등 도 ‘갑’에게 추가로 청구 할 수 있으며 법정이자 또한 추가로 청구 할 수 있다."));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 10조] (대여 계약의 종료)").setFontSize(12));
        document.add(new Paragraph("대여 제품이 정상 반납된 것을 ‘갑’이 직접 확인하여야, 대여 과정 자체가 완료된 것이다."));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 11조] (거래 기록 및 데이터 보관)").setFontSize(12));
        document.add(new Paragraph(""));
        document.add(new Paragraph("①'병'은 ‘갑’과 ‘을’ 간의 거래 내역을 포함한 데이터(거래 일시, 금액, 계약서 사본 등)를 보관하며, 이는 계약 종료 후 1년 동안 저장된다.\n" +
                "②거래 내역은 법적 분쟁 발생 시 증거로 활용될 수 있으며, 당사자가 요청하는 경우 해당 기록을 제공할 수 있다."
        ));
        document.add(new Paragraph(""));
        document.add(new Paragraph("[제 12조] (전자 서명 및 효력)").setFontSize(12));
        document.add(new Paragraph("""
                ① 전자 서명 방식
                본 계약은 ‘갑’, ‘을’, 및 ‘병’의 전자 서명으로 체결된다. 전자 서명은 각 당사자가 본 계약서 상의 내용을 충분히 숙지하고 동의하였음을 증명하는 방법으로, 법적 효력을 갖는다. 전자 서명 방식으로는 공인된 전자 서명 시스템 또는 본 플랫폼에서 제공하는 인증 시스템을 사용한다.
                ② 서명 절차
                계약 당사자는 본 계약서의 내용을 확인한 후, 전자 서명을 하기 전에 본인 인증 절차를 거쳐야 한다. 본인 인증은 휴대폰 인증, 이메일 인증, 공인 인증서 또는 기타 신뢰할 수 있는 인증 방법으로 진행된다. 서명은 각 당사자가 계약서 확인 후 전자적으로 서명 버튼을 클릭함으로써 완료된다.
                ③ 서명 확인 및 보관
                각 당사자가 전자 서명을 완료한 후, 본 계약서는 자동으로 ‘병’이 운영하는 서버에 저장되며, 서명된 계약서의 원본 사본은 ‘갑’과 ‘을’에게 이메일 또는 기타 디지털 방식으로 제공된다. 전자 서명이 완료된 계약서는 수정할 수 없으며, 법적 분쟁 시 증거 자료로 사용될 수 있다.
                ④ 전자 서명의 법적 효력
                본 계약서에 사용된 전자 서명은 전자 문서 및 전자 거래 기본법에 의거하여 법적 효력을 가지며, 본 계약서에 서명한 당사자들은 전자 서명이 본인의 서명임을 인정한다. 전자 서명은 자필 서명과 동일한 법적 효력을 가지며, 계약 당사자들은 이를 법적 분쟁 시 증거로 제출할 수 있다.
                """
        ));
        document.add(new Paragraph("[제 13조] (전자 서명 시스템의 안정성)").setFontSize(12));
        document.add(new Paragraph("본 계약에 사용되는 전자 서명 시스템은 안정적이고 신뢰할 수 있는 방식으로 운영되며, 서명 절차 중 발생하는 오류나 문제에 대해서는 ‘병’이 그 시스템의 안정성을 보장한다. 전자 서명 중 발생한 기술적 오류가 있을 경우, ‘갑’, ‘을’은 즉시 ‘병’에게 알리고, 문제를 해결한 후 다시 서명 절차를 진행한다."));

        //페이지 변경
        document.add(new AreaBreak());
        //탭 위치 조정을 통해 콜론들의 세로 정렬 보장
        float tabPosition = 150f;

        document.add(new Paragraph(LocalDate.now().format(DateTimeFormatter.ofPattern("yyyy년 MM월 dd일"))));

        //갑
        document.add(new Paragraph()
                .addTabStops(new TabStop(tabPosition, TabAlignment.LEFT))
                .add("(갑) 성명\t: " + pdfCreateDto.getOwnerName())
                .add(new Tab())
                .add("\n연락처\t: " + telFormat(pdfCreateDto.getOwnerTel()))
                .add(new Tab())
                .add("\nE-mail\t: " + pdfCreateDto.getOwnerEmail())
                .add(new Tab())
                .add("\n서명\t: "));

        PdfAcroForm form = PdfAcroForm.getAcroForm(pdfDocument, true);

        PdfSignatureFormField ownerSignatureField = PdfSignatureFormField.createSignature(pdfDocument, new Rectangle(100, 670, 50, 30));
        ownerSignatureField.setFieldName("ownerSignature");
        form.addField(ownerSignatureField);

        //을
        document.add(new Paragraph()
                .addTabStops(new TabStop(tabPosition, TabAlignment.LEFT))
                .add("(을) 성명\t: " + pdfCreateDto.getRentalName())
                .add(new Tab())
                .add("\n연락처\t: " + telFormat(pdfCreateDto.getRentalTel()))
                .add(new Tab())
                .add("\nE-mail\t: " + pdfCreateDto.getRentalEmail())
                .add(new Tab())
                .add("\n서명\t: "));

        PdfSignatureFormField rentalSignatureField = PdfSignatureFormField.createSignature(pdfDocument, new Rectangle(100, 570, 50, 30));
        rentalSignatureField.setFieldName("rentalSignature");
        form.addField(rentalSignatureField);

        //병
        document.add(new Paragraph()
                .addTabStops(new TabStop(tabPosition, TabAlignment.LEFT))
                .add("(병) 성명\t: 바로바로(주)")
                .add(new Tab())
                .add("\n연락처\t: 010-1234-5678")
                .add(new Tab())
                .add("\nE-mail\t: barobaro@gmail.com")
                .add(new Tab())
                .add("\n서명\t: "));
        PdfSignatureFormField companySignatureField = PdfSignatureFormField.createSignature(pdfDocument, new Rectangle(100, 470, 50, 30));
        companySignatureField.setFieldName("companySignature");
        form.addField(companySignatureField);

        document.close();
        //서명하기 위해 불러오기
        ByteArrayOutputStream signedOutputStream = new ByteArrayOutputStream();
        PdfReader pdfReader = new PdfReader(new ByteArrayInputStream(byteArrayOutputStream.toByteArray()));
        PdfSigner signer = new PdfSigner(pdfReader, signedOutputStream, new StampingProperties().useAppendMode());

        //바로바로 측 PrivateKey,인증서 가져오기
        PrivateKey companyPK = certificateUtils.getPrivateKey(BAROBARO_ALIAS, BAROBARO_PASSWORD);
        Certificate companyCertificate = certificateUtils.getCertificate(BAROBARO_ALIAS);

        signer.setFieldName("companySignature");

        PdfSignatureAppearance appearance = signer.getSignatureAppearance();
        // 서명 이미지 추가
        appearance.setRenderingMode(PdfSignatureAppearance.RenderingMode.GRAPHIC);
        ImageData imageData = convertBase64ToPngImage(COMPANY_BASE64_SIGNATURE);
        appearance.setSignatureGraphic(imageData);


        //전자서명 추가
        PrivateKeySignature pkSignature = new PrivateKeySignature(companyPK, DigestAlgorithms.SHA256, "BC");
        IExternalDigest digest = new BouncyCastleDigest();
        Certificate[] certificateChain = new Certificate[]{companyCertificate};
        signer.signDetached(digest, pkSignature, certificateChain,
                null, null, null, 0, PdfSigner.CryptoStandard.CMS);


        ByteArrayOutputStream ownerSignedOutputStream = new ByteArrayOutputStream();
        PdfReader ownerPdfReader = new PdfReader(new ByteArrayInputStream(signedOutputStream.toByteArray()));
        PdfSigner ownerSigner = new PdfSigner(ownerPdfReader, ownerSignedOutputStream, new StampingProperties().useAppendMode());

        //바로바로 측 PrivateKey,인증서 가져오기
        PrivateKey ownerPK = certificateUtils.getPrivateKey(BAROBARO_ALIAS, BAROBARO_PASSWORD);
        Certificate ownerCertificate = certificateUtils.getCertificate(BAROBARO_ALIAS);

        ownerSigner.setFieldName("ownerSignature");

        PdfSignatureAppearance ownerAppearance = ownerSigner.getSignatureAppearance();
        // 서명 이미지 추가
        ownerAppearance.setRenderingMode(PdfSignatureAppearance.RenderingMode.GRAPHIC);
        ownerAppearance.setSignatureGraphic(imageData);


        //전자서명 추가
        PrivateKeySignature ownerPkSignature = new PrivateKeySignature(ownerPK, DigestAlgorithms.SHA256, "BC");
        IExternalDigest ownerDigest = new BouncyCastleDigest();
        Certificate[] ownerCertificateChain = new Certificate[]{ownerCertificate};
        ownerSigner.signDetached(ownerDigest, ownerPkSignature, ownerCertificateChain,
                null, null, null, 0, PdfSigner.CryptoStandard.CMS);


        ByteArrayOutputStream rentalSignedOutputStream = new ByteArrayOutputStream();
        PdfReader rentalPdfReader = new PdfReader(new ByteArrayInputStream(ownerSignedOutputStream.toByteArray()));
        PdfSigner rentalSigner = new PdfSigner(rentalPdfReader, rentalSignedOutputStream, new StampingProperties().useAppendMode());

        //바로바로 측 PrivateKey,인증서 가져오기
        PrivateKey rentalPK = certificateUtils.getPrivateKey(BAROBARO_ALIAS, BAROBARO_PASSWORD);
        Certificate rentalCertificate = certificateUtils.getCertificate(BAROBARO_ALIAS);

        rentalSigner.setFieldName("rentalSignature");

        PdfSignatureAppearance rentalAppearance = rentalSigner.getSignatureAppearance();
        // 서명 이미지 추가
        rentalAppearance.setRenderingMode(PdfSignatureAppearance.RenderingMode.GRAPHIC);
        rentalAppearance.setSignatureGraphic(imageData);


        //전자서명 추가
        PrivateKeySignature rentalPkSignature = new PrivateKeySignature(rentalPK, DigestAlgorithms.SHA256, "BC");
        IExternalDigest rentalDigest = new BouncyCastleDigest();
        Certificate[] rentalCertificateChain = new Certificate[]{rentalCertificate};
        rentalSigner.signDetached(rentalDigest, rentalPkSignature, rentalCertificateChain,
                null, null, null, 0, PdfSigner.CryptoStandard.CMS);


        //파일 byteArray 화
//        byte[] pdfBytes = signedOutputStream.toByteArray();
        byte[] pdfBytes = rentalSignedOutputStream.toByteArray();
        //s3 업로드 후, 저장되는 url 반환
        return pdfS3Service.upload(pdfBytes);
    }


    /**
     * @param s3FileUrl          pdf 가 저장된 s3주소
     * @param signatureFieldName 서명할 필드 이름. ownerSignature / rentalSignature 로 구분
     * @param privateKey         서명하는 사람의 privateKey 값
     * @param certificate        서명하는 사람의 인증서.
     * @param imageData          서명 이미지데이터(ImageData 포맷)
     * @return 서명된 pdf 파일을 접근 가능한 s3 url
     */
    public String signPdfAndSave(String s3FileUrl, String signatureFieldName, PrivateKey privateKey, X509Certificate certificate, ImageData imageData) throws IOException, GeneralSecurityException {
        String s3FileName = s3FileUrl.substring(s3FileUrl.lastIndexOf("/") + 1);
        InputStream pdfInputStream = pdfS3Service.download(s3FileName);
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        PdfSigner signer = new PdfSigner(new PdfReader(pdfInputStream), new PdfWriter(byteArrayOutputStream), new StampingProperties().useAppendMode());

        //서명할 필드네임 설정.
        //이미 있는 필드네임이며, 해당 필드에 서명이 이미 있는 경우 -> 에러 발생
        //이미 있는 필드네임이며, 해당 필드에 서명이 없는 경우 -> 해당 필드에 서명 진행
        //없는 필드네임이며, 해당 필드에 서명이 없는 경우 -> 필드 생성 및 서명 진행
        signer.setFieldName(signatureFieldName);
        PdfSignatureAppearance appearance = signer.getSignatureAppearance();
        // 서명 이미지 추가
        appearance.setRenderingMode(PdfSignatureAppearance.RenderingMode.GRAPHIC);
        appearance.setSignatureGraphic(imageData);

        // 서명 추가
        PrivateKeySignature pkSignature = new PrivateKeySignature(privateKey, "SHA-256", "BC");

        IExternalDigest digest = new BouncyCastleDigest();
        Certificate[] certificateChain = new Certificate[]{certificate};

        signer.signDetached(digest, pkSignature, certificateChain,
                null, null, null, 0, PdfSigner.CryptoStandard.CMS);
        byte[] pdfBytes = byteArrayOutputStream.toByteArray();

        return pdfS3Service.upload(pdfBytes);
    }

    /**
     * @param s3FileName         기존 s3에 저장된 keyName
     * @param signatureFieldName 서명할 필드 이름. ownerSignature / rentalSignature 로 구분
     * @param privateKey         서명하는 사람의 privateKey 값
     * @param certificate        서명하는 사람의 인증서.
     * @param base64Image        서명 이미지데이터(base64 포맷)
     * @return 서명된 pdf 파일을 접근 가능한 s3 url
     */
    public String signPdfAndSaveUsingBase64Signature(String s3FileName, String signatureFieldName, PrivateKey privateKey, X509Certificate certificate, String base64Image) throws IOException, GeneralSecurityException {
        ImageData imgData = convertBase64ToPngImage(base64Image);
        return signPdfAndSave(s3FileName, signatureFieldName, privateKey, certificate, imgData);
    }

    public static ImageData convertBase64ToPngImage(String base64Image) {
        String prefixRemovedBase64 = base64Image.split(",")[1];
        byte[] imageBytes = Base64.getDecoder().decode(prefixRemovedBase64);
        return ImageDataFactory.create(imageBytes);
    }

    public boolean verifySignatures(String pdfPath) throws Exception {
        // 서명 검증을 위한 PDF 문서 열기
        String s3FileName = pdfPath.substring(pdfPath.lastIndexOf("/") + 1);
        InputStream pdfInputStream = pdfS3Service.download(s3FileName);
        PdfDocument pdfDocument = new PdfDocument(new PdfReader(pdfInputStream));

        // 서명 유틸리티 생성
        SignatureUtil signatureUtil = new SignatureUtil(pdfDocument);

        // PDF 문서의 모든 서명 필드 가져오기
        List<String> signatureNames = signatureUtil.getSignatureNames();

        // 각 서명 필드를 순차적으로 검증
        for (String name : signatureNames) {
            // 서명 객체 가져오기
            PdfPKCS7 pkcs7 = signatureUtil.verifySignature(name);
            System.out.println(name);

            // 서명이 유효한지 확인
            boolean isSignatureValid = pkcs7.verifySignatureIntegrityAndAuthenticity();
            if (!isSignatureValid) {
                System.out.println("서명이 유효하지 않습니다: " + name);
                return false;
            }

            // 서명한 인증서 확인
            Certificate[] certificates = pkcs7.getSignCertificateChain();
            X509Certificate signingCertificate = (X509Certificate) certificates[0];
            System.out.println("서명자: " + signingCertificate.getSubjectDN());
        }

        System.out.println("모든 서명이 유효합니다.");
        return true;
    }

    public boolean verifySignatures(MultipartFile file) throws Exception {
        // 서명 검증을 위한 PDF 문서 열기

        PdfReader reader = new PdfReader(file.getInputStream());
        PdfDocument pdfDocument = new PdfDocument(reader);
        String documentId = "";
        String firstPageText = PdfTextExtractor.getTextFromPage(pdfDocument.getPage(1));

        documentId = extractDocumentId(firstPageText);
        System.out.println("문서 ID: " + documentId);
        SignatureUtil signatureUtil = new SignatureUtil(pdfDocument);
        Contract contract = contractRepository.findByInitialDocumentSerialNum(documentId)
                .orElseThrow(() -> new CustomException(NOT_MADE_FROM_BAROBARO));
        List<SignatureInformation> signatureInformations = signatureInformationRepository.findByContractId(contract.getId());
        for (String name : signatureUtil.getSignatureNames()) {
            PdfPKCS7 pkcs7 = signatureUtil.readSignatureData(name);

            boolean isVerified = pkcs7.verifySignatureIntegrityAndAuthenticity();
            System.out.println(name + " Is signature verified? " + isVerified);

            Certificate[] certificates = pkcs7.getSignCertificateChain();
            X509Certificate signCert = (X509Certificate) certificates[0];
            signatureInformations.stream()
                    .filter(signatureInformation -> {
                        Long memberId = signatureInformation.getMemberId();
                        try {
                            X509Certificate certificate = certificateUtils.getCertificate(Long.toString(memberId));
                            // signCert와 일치하는지 확인
                            return signCert.equals(certificate);
                        } catch (Exception e) {
                            throw new CustomException(NOT_MADE_FROM_BAROBARO);
                        }
                    })
                    .findFirst()
                    .orElseThrow(() -> new CustomException(NOT_MADE_FROM_BAROBARO));
        }
        System.out.println("모든 서명이 유효합니다.");
        return true;
    }

    private static String extractDocumentId(String text) {
        // 문서 ID가 "문서 ID: " 뒤에 있다고 가정하고 추출
        String prefix = "문서 ID: ";
        if (text.contains(prefix)) {
            int startIndex = text.indexOf(prefix) + prefix.length();
            int endIndex = text.indexOf("\n", startIndex); // 다음 줄로 끝나는 경우
            if (endIndex == -1) { // 다음 줄이 없으면 끝까지 읽음
                endIndex = text.length();
            }
            return text.substring(startIndex, endIndex).trim();
        }
        return null; // 문서 ID를 찾지 못한 경우
    }

}
